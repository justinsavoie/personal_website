<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Jeu de mots ‚Äî Tape & √âcoute</title>
<style>
  :root { --bg:#fffaf2; --ink:#222; --accent:#ff4d4d; --card:#ffffff; --muted:#777; }
  html,body { height:100%; margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; background:var(--bg); color:var(--ink); }
  .wrap { max-width: 780px; margin: 0 auto; padding: 24px; }
  h1 { font-size: clamp(20px, 4vw, 28px); margin: 0 0 10px; }
  .card { background: var(--card); border-radius: 20px; box-shadow: 0 6px 20px rgba(0,0,0,.08); padding: 22px; }
  .word { display:flex; gap: 8px; flex-wrap: wrap; justify-content:center; margin: 16px 0 10px; }
  .letter { display:inline-flex; align-items:center; justify-content:center; width: clamp(38px, 7vw, 56px); height: clamp(52px, 8vw, 70px);
            border-radius: 12px; border: 2px solid #ddd; font-size: clamp(26px, 6vw, 40px); font-weight: 700; background: #fff; transition: transform .08s; }
  .letter.done { color: #fff; background: var(--accent); border-color: var(--accent); }
  .letter.current { box-shadow: 0 0 0 3px rgba(255,77,77,.25) inset; }
  .shake { animation: shake .15s linear 0s 1; }
  @keyframes shake { 25%{ transform: translateX(-3px);} 75%{ transform: translateX(3px);} }
  .status { text-align:center; color: var(--muted); margin: 6px 0 12px; font-size: 15px; }
  .controls { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top: 10px; }
  button { font-size: 16px; padding: 10px 14px; border-radius: 12px; border: 0; background:#222; color:#fff; cursor:pointer; }
  button.secondary { background:#f0f0f0; color:#222; }
  .kbd { margin-top:14px; display:grid; grid-template-columns: repeat(10, 1fr); gap:8px; }
  .kbd button { padding: 12px 0; background:#fff; color:#222; border:2px solid #e7e7e7; }
  .kbd button:active { transform: scale(.98); }
  .hint { text-align:center; font-size: 14px; color: #666; margin-top: 6px; }
  .row { display:flex; gap:10px; justify-content:center; align-items:center; flex-wrap:wrap; }
  label { font-size:14px; color:#444; }
  select { padding:8px 10px; border-radius:10px; border:1px solid #ddd; }
  input[type="checkbox"]{ transform: scale(1.2); }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Apprends les mots : tape & √©coute üî§üîä</h1>
    <div class="card">
      <div id="word" class="word" aria-live="polite"></div>
      <div id="status" class="status">Tape la lettre suivante (clavier ou boutons). Espace = üîä</div>

      <div class="controls">
        <button id="speakBtn" type="button">üîä √âcouter</button>
        <button id="newBtn" class="secondary" type="button">Nouveau mot ‚Üª</button>
        <button id="skipBtn" class="secondary" type="button">Passer ‚è≠</button>
      </div>

      <div class="row" style="margin-top:8px;">
        <label><input id="autoRead" type="checkbox" checked> Lire automatiquement</label>
        <label>Voix: <select id="voiceSelect"></select></label>
        <label>Vitesse: <input id="rate" type="range" min="0.6" max="1.2" step="0.05" value="0.95"></label>
      </div>

      <div id="keyboard" class="kbd" aria-label="Clavier √† l'√©cran"></div>
      <div class="hint">Astuce : Les accents sont accept√©s en tapant la lettre simple (ex. ¬´ e ¬ª pour ¬´ √© ¬ª). Appuie sur Espace pour r√©-√©couter.</div>
    </div>
  </div>

<script>
(() => {
  // ---- Words ----
  const WORDS = [
    "bonjour","√©cole","maison","fromage","soleil",
    "voiture","pomme","chien","chat","livre",
    "famille","h√¥pital","for√™t","gar√ßon","fille"
  ];

  // ---- UI refs ----
  const wordEl = document.getElementById('word');
  const statusEl = document.getElementById('status');
  const newBtn = document.getElementById('newBtn');
  const skipBtn = document.getElementById('skipBtn');
  const kbEl = document.getElementById('keyboard');
  const speakBtn = document.getElementById('speakBtn');
  const autoRead = document.getElementById('autoRead');
  const voiceSelect = document.getElementById('voiceSelect');
  const rateInput = document.getElementById('rate');

  // ---- Game state ----
  let current = "", currentNorm = "", idx = 0, lastWord = "";

  // ---- Helpers ----
  const normalize = s => s.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();

  function pickWord() {
    let w; do { w = WORDS[Math.random()*WORDS.length|0]; } while (WORDS.length>1 && w===lastWord);
    lastWord = w; return w;
  }

  function renderWord() {
    wordEl.innerHTML = "";
    for (let i=0;i<current.length;i++){
      const span = document.createElement('span');
      span.className = 'letter' + (i===idx ? ' current' : '');
      span.textContent = current[i].toUpperCase();
      wordEl.appendChild(span);
    }
  }

  function setStatus(msg){ statusEl.textContent = msg; }
  function wrongFlash(){
    wordEl.classList.remove('shake'); void wordEl.offsetWidth; wordEl.classList.add('shake');
  }

  function loadNewWord() {
    current = pickWord();
    currentNorm = normalize(current);
    idx = 0;
    renderWord();
    setStatus("Tape la lettre suivante‚Ä¶");
    if (autoRead.checked) speak(current);
  }

  function handleInput(ch){
    if (!current || !/^[a-z]$/.test(ch)) return;
    const expected = currentNorm[idx];
    if (ch === expected){
      const span = wordEl.children[idx];
      span.classList.add('done'); span.classList.remove('current');
      idx++;
      if (idx < current.length) {
        wordEl.children[idx].classList.add('current');
      } else {
        setStatus("Bravo ! Nouveau mot‚Ä¶");
        setTimeout(loadNewWord, 700);
      }
    } else {
      wrongFlash();
    }
  }

  // ---- On-screen keyboard ----
  "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").forEach(k=>{
    const b=document.createElement('button'); b.type="button"; b.textContent=k;
    b.addEventListener('click', ()=>handleInput(k.toLowerCase())); kbEl.appendChild(b);
  });

  // ---- Keyboard events ----
  window.addEventListener('keydown', (e)=>{
    if (e.key === ' ') { e.preventDefault(); speak(current); return; }
    const map = { '√©':'e','√®':'e','√™':'e','√´':'e','√†':'a','√¢':'a','√Æ':'i','√Ø':'i','√¥':'o','√∂':'o','√π':'u','√ª':'u','√º':'u','√ß':'c' };
    handleInput((map[e.key]||e.key).toLowerCase());
  });

  newBtn.addEventListener('click', loadNewWord);
  skipBtn.addEventListener('click', loadNewWord);
  speakBtn.addEventListener('click', ()=>speak(current));

  // ---- Text-to-Speech (Web Speech API) ----
  let voices = [];
  function loadVoices(){
    voices = window.speechSynthesis.getVoices();
    // Prefer fr-* voices
    const frVoices = voices.filter(v => /^fr(-|_|$)/i.test(v.lang));
    const list = frVoices.length ? frVoices : voices;
    voiceSelect.innerHTML = "";
    list.forEach((v,i)=>{
      const opt=document.createElement('option');
      opt.value = v.name; opt.textContent = `${v.name} (${v.lang})` + (frVoices.length ? "" : " *");
      voiceSelect.appendChild(opt);
    });
    // Select a decent default
    const preferred = list.find(v => /France|Canadian/i.test(v.name)) || list[0];
    if (preferred) voiceSelect.value = preferred.name;
  }
  loadVoices();
  if (typeof speechSynthesis !== 'undefined') {
    speechSynthesis.onvoiceschanged = loadVoices;
  }

  function speak(text){
    if (!text || !window.speechSynthesis) return;
    window.speechSynthesis.cancel(); // stop anything pending
    const u = new SpeechSynthesisUtterance(text);
    // Pick selected voice or best fr-* fallback
    const byName = voices.find(v => v.name === voiceSelect.value);
    const frFallback = voices.find(v => /^fr(-|_|$)/i.test(v.lang));
    u.voice = byName || frFallback || voices[0] || null;
    u.lang  = (u.voice && u.voice.lang) || 'fr-FR';
    u.rate  = parseFloat(rateInput.value) || 0.95;  // slower is clearer for kids
    u.pitch = 1.0;
    speechSynthesis.speak(u);
  }

  // ---- Start ----
  loadNewWord();
})();
</script>
</body>
</html>
